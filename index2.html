<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hvor skal jeg parkere?</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .result {
            margin-top: 20px;
        }
        .parking-options {
            list-style-type: none;
            padding: 0;
        }
        .parking-options li {
            margin-bottom: 10px;
        }
        .highlight {
            background-color: darkgreen;
            color: white;
        }
        .map-placeholder {
            width: 100%;
            height: 300px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .cost-details {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hvor skal jeg parkere?</h1>
        <div class="input-group">
            <label for="start-datetime">Parkering start:</label>
            <input type="datetime-local" id="start-datetime">
        </div>
        <div class="input-group">
            <label for="end-datetime">Parkering slut:</label>
            <input type="datetime-local" id="end-datetime">
        </div>
        <div class="result">
            <ul class="parking-options">
                <li id="option-a">København Vesterbro: <span id="price-a"></span> kr</li>
                <li id="option-b">Carlsberg Byen: <span id="price-b"></span> kr</li>
                <li id="option-c">Frederiksberg: <span id="price-c"></span> kr</li>
            </ul>
        </div>
        <div class="map-placeholder">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Carlsberg_Byen_OpenStreetMap_01.png" alt="Kort over Carlsberg Byen" style="width:100%; height:100%;">
        </div>
        <div class="cost-details">
            <h3>København Vesterbro</h3>
            <p>Mandag - Fredag 08:00-18:00 16kr</p>
            <p>Mandag - Fredag 18:00-23:00 17kr</p>
            <p>Mandag - Fredag 23:00-08:00 6kr</p>
            <p>Lørdag 08:00 til 17:00 16kr</p>
            <p>Lørdag 17:00 til Mandag 08:00 0kr</p>
            <h3>Carlsberg Byen</h3>
            <p>16 kr per time</p>
            <h3>Frederiksberg</h3>
            <p>Mandag til Fredag 07:00 til 24:00</p>
            <p>Lørdag 07:00 til 17:00</p>
            <p>Andre tider er gratis.</p>
            <p>Maks 110 kr per dag og 550 kr per uge</p>
            <p>1. time: 5 kr</p>
            <p>2. time: 10 kr</p>
            <p>3. time: 15 kr</p>
            <p>4. time: 20 kr</p>
            <p>5. time: 25 kr</p>
            <p>6. time: 25 kr</p>
        </div>
    </div>
    <script>
        document.getElementById('start-datetime').addEventListener('input', calculateParkingCost);
        document.getElementById('end-datetime').addEventListener('input', calculateParkingCost);

        function calculateParkingCost() {
            const startDateTime = document.getElementById('start-datetime').value;
            const endDateTime = document.getElementById('end-datetime').value;

            if (!startDateTime || !endDateTime) return;

            const start = new Date(startDateTime);
            const end = new Date(endDateTime);
            const hours = (end - start) / 1000 / 60 / 60;

            if (hours <= 0) return;

            const priceA = calculatePriceA(start, end);
            const priceB = 16 * hours;
            const priceC = calculatePriceC(start, end);

            document.getElementById('price-a').innerText = priceA.toFixed(2);
            document.getElementById('price-b').innerText = priceB.toFixed(2);
            document.getElementById('price-c').innerText = priceC.toFixed(2);

            highlightCheapestOption(priceA, priceB, priceC);
        }

        function calculatePriceA(start, end) {
            let total = 0;
            let current = new Date(start);

            while (current < end) {
                const day = current.getDay();
                const hour = current.getHours();

                if (day === 0 || (day === 6 && (hour >= 17 || hour < 8))) {
                    current.setHours(current.getHours() + 1);
                    continue;
                } else if (hour >= 8 && hour < 18) {
                    total += 16;
                } else if (hour >= 18 && hour < 23) {
                    total += 17;
                } else {
                    total += 6;
                }

                current.setHours(current.getHours() + 1);
            }

            return total;
        }

        function calculatePriceC(start, end) {
            let total = 0;
            let dailyTotal = 0;
            let weeklyTotal = 0;
            let current = new Date(start);

            while (current < end) {
                const day = current.getDay();
                const hour = current.getHours();
                const minute = current.getMinutes();

                const isChargeable = (day >= 1 && day <= 5 && hour >= 7 && hour < 24) || (day === 6 && hour >= 7 && hour < 17);

                if (isChargeable) {
                    if (dailyTotal < 110) {
                        const remainingMinutesToday = (24 - hour) * 60 - minute;
                        const remainingMinutes = Math.min((end - current) / 1000 / 60, remainingMinutesToday);
                        const dailyMinutes = Math.min(remainingMinutes, 24 * 60 - (hour * 60 + minute));
                        
                        const hourIntervals = [
                            { maxMinutes: 60, rate: 5 },
                            { maxMinutes: 60, rate: 10 },
                            { maxMinutes: 60, rate: 15 },
                            { maxMinutes: 60, rate: 20 },
                            { maxMinutes: 60, rate: 25 },
                            { maxMinutes: 60, rate: 25 },
                        ];

                        let intervalIndex = 0;
                        let intervalMinutes = 0;

                        while (intervalMinutes < dailyMinutes && intervalIndex < hourIntervals.length) {
                            const interval = hourIntervals[intervalIndex];
                            const remainingIntervalMinutes = interval.maxMinutes - intervalMinutes;
                            const chargeableMinutes = Math.min(dailyMinutes - intervalMinutes, remainingIntervalMinutes);

                            dailyTotal += (chargeableMinutes / 60) * interval.rate;
                            intervalMinutes += chargeableMinutes;

                            if (intervalMinutes >= interval.maxMinutes) {
                                intervalIndex++;
                                intervalMinutes = 0;
                            }
                        }
                    }
                }

                current.setMinutes(current.getMinutes() + 1);
                if (current.getHours() === 0 && current.getMinutes() === 0) {
                    weeklyTotal += dailyTotal;
                    dailyTotal = 0;
                }

                if (weeklyTotal >= 550) {
                    total = 550;
                    break;
                }
            }

            return Math.min(total, 550);
        }

        function highlightCheapestOption(priceA, priceB, priceC) {
            document.getElementById('option-a').classList.remove('highlight');
            document.getElementById('option-b').classList.remove('highlight');
            document.getElementById('option-c').classList.remove('highlight');

            const minPrice = Math.min(priceA, priceB, priceC);

            if (priceA === minPrice) {
                document.getElementById('option-a').classList.add('highlight');
            }
            if (priceB === minPrice) {
                document.getElementById('option-b').classList.add('highlight');
            }
            if (priceC === minPrice) {
                document.getElementById('option-c').classList.add('highlight');
            }
        }
    </script>
</body>
</html>